<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo2.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Shippori Mincho:300,300italic,400,400italic,700,700italic|Inconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"linglingdr00.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

<link rel="preconnect" href="https://fonts.loli.net">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.loli.net/css2?family=Noto+Serif+TC:wght@500;600;700&family=Shippori+Mincho:wght@500;600;700&display=swap" rel="stylesheet">
  <meta name="description" content="在本程式碼研究室中，您要為 Inventory app 新增更多功能，並學習如何使用 Room 讀取、顯示、更新及刪除 SQLite database 中的 data。使用 RecyclerView 顯示 database 中的 data，並在 database 中的基礎資料(underlying data)發生變更時自動更新 data。  學習目標  如何讀取及顯示 SQLite databa">
<meta property="og:type" content="article">
<meta property="og:title" content="Android筆記(41)-使用Room讀取和更新data">
<meta property="og:url" content="https://linglingdr00.github.io/2023/12/22/Android%E7%AD%86%E8%A8%98-41-%E4%BD%BF%E7%94%A8Room%E8%AE%80%E5%8F%96%E5%92%8C%E6%9B%B4%E6%96%B0data/index.html">
<meta property="og:site_name" content="Tina Tang&#39;s Blog">
<meta property="og:description" content="在本程式碼研究室中，您要為 Inventory app 新增更多功能，並學習如何使用 Room 讀取、顯示、更新及刪除 SQLite database 中的 data。使用 RecyclerView 顯示 database 中的 data，並在 database 中的基礎資料(underlying data)發生變更時自動更新 data。  學習目標  如何讀取及顯示 SQLite databa">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/771c6a677ecd96c7_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/d6e7b7b9f12e7a16_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/9c416f2fbf1e5ae2_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/9c416f2fbf1e5ae2_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/d699618f5d9437df_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/196553111ee69beb_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/9c416f2fbf1e5ae2_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/ac6529b8cc0801ac_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/aa63ca761dc8f009_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/3e099d3c55596938_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/5e49db8451e77c2b_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/728bfcbb997c8017_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/c05318ab8c216fa1_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/bcd407af7c515a21_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/a6a6583171b68230_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/829ceb9dd7993215_1920.png?hl=zh-tw">
<meta property="og:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/1bbd094a77c25fc4_1920.png?hl=zh-tw">
<meta property="article:published_time" content="2023-12-22T07:26:08.000Z">
<meta property="article:modified_time" content="2023-12-24T08:46:28.094Z">
<meta property="article:author" content="Tina Tang">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Kotlin">
<meta property="article:tag" content="RecyclerView">
<meta property="article:tag" content="Data Class">
<meta property="article:tag" content="Navigation">
<meta property="article:tag" content="Fragment">
<meta property="article:tag" content="ViewModel">
<meta property="article:tag" content="LiveData">
<meta property="article:tag" content="Coroutine">
<meta property="article:tag" content="suspend function">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="ListAdapter">
<meta property="article:tag" content="Room">
<meta property="article:tag" content="DAO">
<meta property="article:tag" content="Entity">
<meta property="article:tag" content="Flow">
<meta property="article:tag" content="SQLite">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/771c6a677ecd96c7_1920.png?hl=zh-tw">

<link rel="canonical" href="https://linglingdr00.github.io/2023/12/22/Android%E7%AD%86%E8%A8%98-41-%E4%BD%BF%E7%94%A8Room%E8%AE%80%E5%8F%96%E5%92%8C%E6%9B%B4%E6%96%B0data/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-tw'
  };
</script>

  <title>Android筆記(41)-使用Room讀取和更新data | Tina Tang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Tina Tang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">在哪裡跌倒了，就在哪裡躺下來</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://linglingdr00.github.io/2023/12/22/Android%E7%AD%86%E8%A8%98-41-%E4%BD%BF%E7%94%A8Room%E8%AE%80%E5%8F%96%E5%92%8C%E6%9B%B4%E6%96%B0data/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blog_photo.png">
      <meta itemprop="name" content="Tina Tang">
      <meta itemprop="description" content="^(-o-)>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tina Tang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android筆記(41)-使用Room讀取和更新data
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-22 15:26:08" itemprop="dateCreated datePublished" datetime="2023-12-22T15:26:08+08:00">2023-12-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-12-24 16:46:28" itemprop="dateModified" datetime="2023-12-24T16:46:28+08:00">2023-12-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/Android-Kotlin%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E8%AA%B2%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Android Kotlin基本概念課程</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/Android-Kotlin%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E8%AA%B2%E7%A8%8B/Data-persistence/" itemprop="url" rel="index"><span itemprop="name">Data persistence</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>在本程式碼研究室中，您要為 Inventory app 新增更多功能，並學習如何使用 <code>Room</code> <u>讀取、顯示、更新及刪除</u> <strong>SQLite database</strong> 中的 data。使用 <code>RecyclerView</code> 顯示 database 中的 data，並在 database 中的<b>基礎資料(underlying data)</b>發生變更時<u>自動更新 data</u>。</p>
</blockquote>
<p><strong>學習目標</strong></p>
<ul>
<li>如何<u>讀取及顯示</u> SQLite database 中的 <strong>entities</strong>。</li>
<li>如何使用 <code>Room</code> library <u>更新和刪除</u> SQLite database 中的 <strong>entities</strong>。</li>
</ul>
<span id="more"></span>

<hr>
<h3 id="Starter-app-overview"><a href="#Starter-app-overview" class="headerlink" title="Starter app overview"></a>Starter app overview</h3><p>本程式碼研究室會使用先前程式碼研究室的 Inventory app solution code，做為範例程式碼。範例 app 已使用 <code>Room</code> persistence library 儲存 data。使用者可以透過「Add Item」畫面，將 data 新增至 app database。</p>
<p>注意：目前版本的範例 app 不會顯示 database 中儲存的日期(date)。</p>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/771c6a677ecd96c7_1920.png?hl=zh-tw">

<p>在本程式碼研究室中，您將擴充 app，使其<u>使用 <code>Room</code> library 讀取及顯示 database 中的 data</u>，以及<u>更新及刪除 database 中的 <strong>entities</strong></u>。</p>
<h4 id="下載範例程式碼"><a href="#下載範例程式碼" class="headerlink" title="下載範例程式碼"></a>下載範例程式碼</h4><p>這個範例程式碼與先前程式碼研究室的 solution code 相同。</p>
<div class="note success">
            <p><strong>範例程式碼網址：</strong><a target="_blank" rel="noopener" href="https://github.com/google-developer-training/android-basics-kotlin-inventory-app/tree/room">https://github.com/google-developer-training/android-basics-kotlin-inventory-app/tree/room</a><br><strong>分支名稱：</strong><b>room</b></p>
          </div>

<hr>
<h3 id="新增-RecyclerView"><a href="#新增-RecyclerView" class="headerlink" title="新增 RecyclerView"></a>新增 RecyclerView</h3><p>在這項工作中，您要在 app 中新增 <code>RecyclerView</code>，以顯示 database 中儲存的 data。</p>
<h4 id="新增-helper-function-以-format-price"><a href="#新增-helper-function-以-format-price" class="headerlink" title="新增 helper function 以 format price"></a>新增 helper function 以 format price</h4><p>以下是最終 app 的螢幕截圖。</p>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/d6e7b7b9f12e7a16_1920.png?hl=zh-tw" width="40%">

<p>請注意，price 會以<u>貨幣格式(currency format)</u>顯示。如要將 <u>double value</u>轉換成所需的<u>貨幣格式(currency format)</u>，請在 <code>Item</code> class 中加入 <strong>extension function</strong>。</p>
<h5 id="Extension-Functions"><a href="#Extension-Functions" class="headerlink" title="Extension Functions"></a>Extension Functions</h5><p>Kotlin 能夠<u>使用新功能<b>擴充(extend)</b> class</u>，無需沿用 class 或修改 class 的現有定義。這表示您可以將 functions 加入現有 class，而無需存取其原始碼。方法是透過名為<a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/extensions.html">擴充功能</a>的特殊宣告來執行。</p>
<p>舉例來說，您可以<u>在無法修改的<b>第三方 library</b> 中，為某個 <strong>class</strong> 編寫新的 <strong>functions</strong></u>。這類 functions 可以照常呼叫，就像是原始 class 的方法一樣。這些 functions 稱為 <strong>extension function</strong>。(您也可以使用 <b>extension properties(擴充屬性)</b>為現有 class 定義新屬性)。</p>
<p><strong>Extension function</strong> 實際上<u>不會修改 class</u>，但可以讓您<u>在呼叫該 <strong>class objects</strong> 的 <strong>function</strong> 時</u>使用<b>點號標記法( <code>.</code> )</b>。</p>
<p>例如，在下列程式碼中，有一個名為 <code>Square</code> 的 class。此 class 內會有<u>正方形四邊的屬性 <code>side</code></u>，以及<u>計算正方形面積的 function <code>area()</code></u>。請注意，<u><code>Square.perimeter()</code> <strong>extension function</strong> 的 <b>function name 開頭</b>是其使用的 <strong>class</strong></u>。在 function 中，您<u>可以引用 <code>Square</code> class 的 public 屬性( <code>side</code> )</u>。</p>
<p>查看 <code>main()</code> function 中的 extension function 使用方式。建立的 extension function <code>perimeter()</code> 會在該 <code>Square</code> class 中做為一般 function 呼叫。</p>
<p>範例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span>(<span class="keyword">val</span> side: <span class="built_in">Double</span>)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">area</span><span class="params">()</span></span>: <span class="built_in">Double</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> side * side;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Extension function to calculate the perimeter of the square</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Square.<span class="title">perimeter</span><span class="params">()</span></span>: <span class="built_in">Double</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">4</span> * side;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span>&#123;</span><br><span class="line">      <span class="keyword">val</span> square = Square(<span class="number">5.5</span>);</span><br><span class="line">      <span class="keyword">val</span> perimeterValue = square.perimeter()</span><br><span class="line">      println(<span class="string">&quot;Perimeter: <span class="variable">$perimeterValue</span>&quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> areaValue = square.area()</span><br><span class="line">      println(<span class="string">&quot;Area: <span class="variable">$areaValue</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在這個步驟中，您要將 <strong>item price</strong> 轉換為<u>貨幣格式(currency format) string</u>。一般而言，建議您<u>不要只是為了設定 data 格式而去變更代表 data 的 <strong>entity class</strong></u> (請參見<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Single_responsibility_principle">單一責任原則</a>)，您可改為新增 <strong>extension function</strong>。</p>
<ol>
<li>在 <code>Item.kt</code> 的 class 定義下方，新增名為 <code>Item.getFormattedPrice()</code> 的 extension function，該 function 不使用參數並且會 return <code>String</code>。請注意 function 名稱中的 <strong>class name</strong> 和<b>點號( <code>.</code> )標記</b>。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Item.<span class="title">getFormattedPrice</span><span class="params">()</span></span>: String =</span><br><span class="line">   NumberFormat.getCurrencyInstance().format(itemPrice)</span><br></pre></td></tr></table></figure>
<ul>
<li>import <code>java.text.NumberFormat</code>。</li>
</ul>
<p>或者：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增 Item 的 extension function</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Item.<span class="title">getFormatPrice</span><span class="params">()</span></span>:String &#123;</span><br><span class="line">    <span class="comment">// 將 item price 轉換為貨幣格式(currency format) string</span></span><br><span class="line">    <span class="keyword">return</span> NumberFormat.getCurrencyInstance().format(itemPrice)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="新增-ListAdapter"><a href="#新增-ListAdapter" class="headerlink" title="新增 ListAdapter"></a>新增 ListAdapter</h4><p>在這個步驟中，您要在 <code>RecyclerView</code> 中新增 <strong>list adapter</strong>。鑒於您熟悉了之前程式碼研究室中有關實作 adapter 的內容，操作說明匯總如下。為了方便起見，這個步驟最後提供了完整的 <code>ItemListAdapter</code> 檔案，可協助您瞭解程式碼研究室中的 <code>Room</code> 概念。</p>
<ol>
<li>在 <code>com.example.inventory</code> package 中，新增名為 <code>ItemListAdapter</code> 的 Kotlin class。傳入名為 <code>onItemClicked()</code> 的 function 做為 constructor 參數，並將 <code>Item</code> object 做為參數使用。</li>
<li>變更 <code>ItemListAdapter</code> class signature 來繼承(extend) <code>ListAdapter</code>。傳入 <code>Item</code> 和 <code>ItemListAdapter.ItemViewHolder</code> 做為參數。</li>
<li>新增 constructor 參數 <code>DiffCallback</code>；<code>ListAdapter</code> 會使用這項參數來<u>偵測 list 中的變更內容</u>。</li>
<li>覆寫必要的方法 <code>onCreateViewHolder()</code> 和 <code>onBindViewHolder()</code>。</li>
<li><code>onCreateViewHolder()</code> 方法會在 <code>RecyclerView</code> 需要時 return 新的 <code>ViewHolder</code>。</li>
<li>在 <code>onCreateViewHolder()</code> 方法中，建立一個新的 <code>View</code>，並&gt;使用自動產生的 binding class <code>ItemListItemBinding</code> 從 <code>item_list_item.xml</code> layout 檔案加載它。</li>
<li>實作 <code>onBindViewHolder()</code> 方法。使用 <code>getItem()</code> 方法取得 <strong>current item</strong>，並傳遞 <strong>position</strong>。</li>
<li>在 <code>itemView</code> 上設定 <strong>click listener</strong>，在 listener 中呼叫 function <code>onItemClicked()</code>。</li>
<li>定義 <code>ItemViewHolder</code> class，並從 <code>RecyclerView.ViewHolder</code> 繼承該 class。覆寫 <code>bind()</code> function，並傳入 <code>Item</code> object。</li>
<li>定義 <strong>companion object</strong>。在 companion object 中，定義 type 為 <code>DiffUtil.ItemCallback&lt;Item&gt;()</code> 且名稱為 <code>DiffCallback</code> 的 <code>val</code>。覆寫必要的方法 <code>areItemsTheSame()</code> 和 <code>areContentsTheSame()</code>，然後加以定義。</li>
</ol>
<p>完成的 class 應如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.inventory</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.DiffUtil</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.ListAdapter</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.RecyclerView</span><br><span class="line"><span class="keyword">import</span> com.example.inventory.<span class="keyword">data</span>.Item</span><br><span class="line"><span class="keyword">import</span> com.example.inventory.<span class="keyword">data</span>.getFormattedPrice</span><br><span class="line"><span class="keyword">import</span> com.example.inventory.databinding.ItemListItemBinding</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* [ListAdapter] implementation for the recyclerview.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ItemListAdapter</span>(<span class="keyword">private</span> <span class="keyword">val</span> onItemClicked: (Item) -&gt; <span class="built_in">Unit</span>) :</span><br><span class="line">   ListAdapter&lt;Item, ItemListAdapter.ItemViewHolder&gt;(DiffCallback) &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateViewHolder</span><span class="params">(parent: <span class="type">ViewGroup</span>, viewType: <span class="type">Int</span>)</span></span>: ItemViewHolder &#123;</span><br><span class="line">       <span class="keyword">return</span> ItemViewHolder(</span><br><span class="line">           ItemListItemBinding.inflate(</span><br><span class="line">               LayoutInflater.from(</span><br><span class="line">                   parent.context</span><br><span class="line">               )</span><br><span class="line">           )</span><br><span class="line">       )</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBindViewHolder</span><span class="params">(holder: <span class="type">ItemViewHolder</span>, position: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">       <span class="keyword">val</span> current = getItem(position)</span><br><span class="line">       holder.itemView.setOnClickListener &#123;</span><br><span class="line">           onItemClicked(current)</span><br><span class="line">       &#125;</span><br><span class="line">       holder.bind(current)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">class</span> <span class="title class_">ItemViewHolder</span>(<span class="keyword">private</span> <span class="keyword">var</span> binding: ItemListItemBinding) :</span><br><span class="line">       RecyclerView.ViewHolder(binding.root) &#123;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">val</span> DiffCallback = <span class="keyword">object</span> : DiffUtil.ItemCallback&lt;Item&gt;() &#123;</span><br><span class="line">           <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">areItemsTheSame</span><span class="params">(oldItem: <span class="type">Item</span>, newItem: <span class="type">Item</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">               <span class="keyword">return</span> oldItem === newItem</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">areContentsTheSame</span><span class="params">(oldItem: <span class="type">Item</span>, newItem: <span class="type">Item</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">               <span class="keyword">return</span> oldItem.itemName == newItem.itemName</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>在 <code>ItemViewHolder</code> class 中實作 <code>bind()</code>  function。將 <code>itemName</code> TextView bind 至 <code>item.itemName</code>。使用 <code>getFormattedPrice()</code> extension function 以貨幣格式(currency format)取得 price，並將其 bind 至 <code>itemPrice</code> TextView。將 <code>quantityInStock</code> 值轉換為 <code>String</code>，並將其 bind 至 <code>itemQuantity</code> TextView。已完成的方法應如下所示：</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   binding.apply &#123;</span><br><span class="line">       itemName.text = item.itemName</span><br><span class="line">       itemPrice.text = item.getFormattedPrice()</span><br><span class="line">       itemQuantity.text = item.quantityInStock.toString()</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>import <code>com.example.inventory.data.getFormattedPrice</code>。</li>
</ul>
<p>從完成的 app 查看 inventory list 畫面。請注意，每個 list element 都會顯示 inventory item 的 <u>name</u>、<u>以貨幣格式(currency format)顯示的 price</u>，以及 <u>current stock</u>。在先前的步驟中，您使用了 <code>item_list_item.xml</code> layout 檔案和三個 <code>TextView</code> 來建立 rows。在下一個步驟中，您要將 entity 的詳細資料(details) bind 至這些 <code>TextView</code>。</p>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/9c416f2fbf1e5ae2_1920.png?hl=zh-tw" width="40%">

<h4 id="使用-ListAdapter"><a href="#使用-ListAdapter" class="headerlink" title="使用 ListAdapter"></a>使用 ListAdapter</h4><p>在這項工作中，您要更新 <code>InventoryViewModel</code> 和 <code>ItemListFragment</code>，以便使用您在上一個步驟中建立的 <strong>list adapter</strong>，在畫面中顯示 item 詳細資料(details)。</p>
<ol>
<li>在 <code>InventoryViewModel</code> class 的開頭，針對 <u>database 中的 item</u>，建立一個名為 <code>allItems</code> 且 type 為 <code>LiveData&lt;List&lt;Item&gt;&gt;</code> 的 <code>val</code>。如果出現錯誤，別擔心，您將很快進行修正。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> allItems: LiveData&lt;List&lt;Item&gt;&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>import <code>androidx.lifecycle.LiveData</code>。</li>
</ul>
<ol start="2">
<li>在 <code>itemDao</code> 上呼叫 <code>getItems()</code>，並指派給 <code>allItems</code>。<code>getItems()</code> function 會 return <code>Flow</code>。如要以 <code>LiveData</code> 值的形式使用 data，請使用 <code>asLiveData()</code> function。已完成的定義應如下所示：</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> allItems: LiveData&lt;List&lt;Item&gt;&gt; = itemDao.getItems().asLiveData()</span><br></pre></td></tr></table></figure>
<ul>
<li>import <code>androidx.lifecycle.asLiveData</code>。</li>
</ul>
<ol start="3">
<li>在 <code>ItemListFragment</code> 中，請於 class 開頭宣告一個 type 為 <code>InventoryViewModel</code> 的 <code>private</code> 不可變屬性 <code>viewModel</code>。使用 <code>by</code> 委派，將屬性初始化作業傳送至 <code>activityViewModels</code> class。傳入 <code>InventoryViewModelFactory</code> constructor。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> viewModel: InventoryViewModel <span class="keyword">by</span> activityViewModels &#123;</span><br><span class="line">   InventoryViewModelFactory(</span><br><span class="line">       (activity?.application <span class="keyword">as</span> InventoryApplication).database.itemDao()</span><br><span class="line">   )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>import <code>androidx.fragment.app.activityViewModels</code>。</li>
</ul>
<ol start="4">
<li><p>同樣在 <code>ItemListFragment</code> 中，捲動至 function <code>onViewCreated()</code>。在 <code>super.onViewCreated()</code> 呼叫下方，宣告名為 <code>adapter</code> 的 <code>val</code>。使用預設 constructor 初始化新的 <code>adapter</code> 屬性，<code>ItemListAdapter&#123;&#125;</code> 不會傳入任何內容。</p>
</li>
<li><p>將新建立的 <code>adapter</code>  bind 至 <code>recyclerView</code>，如下所示：</p>
</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> adapter = ItemListAdapter &#123;</span><br><span class="line">&#125;</span><br><span class="line">binding.recyclerView.adapter = adapter</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><p>設定 adapter 後，仍位於 <code>onViewCreated()</code> 內。在 <code>allItems</code> 上附加 <strong>observer</strong>，<u>監聽 data 變更</u>。</p>
</li>
<li><p>在 observer 內，對 <code>adapter</code> 呼叫 <code>submitList()</code>，並傳遞新的 list。此操作會使用 list 中的新 item 更新 <code>RecyclerView</code>。</p>
</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">viewModel.allItems.observe(<span class="keyword">this</span>.viewLifecycleOwner) &#123; items -&gt;</span><br><span class="line">   items.let &#123;</span><br><span class="line">       adapter.submitList(it)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>確認已完成的 <code>onViewCreated()</code> 方法如下所示。執行 app。請注意，如果您將 item 儲存在 app database 中，則系統會顯示 inventory list。如果 list 為 empty，請新增部分 inventory items 至 app database。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">   <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">val</span> adapter = ItemListAdapter &#123;</span><br><span class="line">      &#125;</span><br><span class="line">   binding.recyclerView.adapter = adapter</span><br><span class="line">   viewModel.allItems.observe(<span class="keyword">this</span>.viewLifecycleOwner) &#123; items -&gt;</span><br><span class="line">       items.let &#123;</span><br><span class="line">           adapter.submitList(it)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   binding.recyclerView.layoutManager = LinearLayoutManager(<span class="keyword">this</span>.context)</span><br><span class="line">   binding.floatingActionButton.setOnClickListener &#123;</span><br><span class="line">       <span class="keyword">val</span> action = ItemListFragmentDirections.actionItemListFragmentToAddItemFragment(</span><br><span class="line">           getString(R.string.add_fragment_title)</span><br><span class="line">       )</span><br><span class="line">       <span class="keyword">this</span>.findNavController().navigate(action)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/9c416f2fbf1e5ae2_1920.png?hl=zh-tw" width="40%">

<hr>
<h3 id="顯示-item-details"><a href="#顯示-item-details" class="headerlink" title="顯示 item details"></a>顯示 item details</h3><p>在這項工作中，您將在「Item Details」畫面中讀取並顯示 <strong>entity details</strong>。您要使用 <strong>primary key</strong> (也就是 <u>item <code>id</code></u>) 來從 inventory app <strong>database</strong> 中讀取 <strong>details</strong> (例如 <u>name、price 和 quantity</u>)，並使用 <code>fragment_item_detail.xml</code> layout 檔案將這些 details 顯示在「Item Details」畫面上。我們已預先為您設計好 layout 檔案 (<code>fragment_item_detail.xml</code>)，當中包含三個用來顯示 item details 的 <code>TextView</code>。</p>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/d699618f5d9437df_1920.png?hl=zh-tw" width="80%">

<p>在這項工作中，您將執行下列步驟：</p>
<ul>
<li>在 <code>RecyclerView</code> 中新增 <strong>click handler</strong>，將 app 移至「Item Details」畫面。</li>
<li>在 <code>ItemListFragment</code> fragment 中，從 <strong>database</strong> 擷取並顯示 data。</li>
<li>將 <code>TextView</code> bind 至 <code>ViewModel</code> data。</li>
</ul>
<h4 id="新增-click-handler"><a href="#新增-click-handler" class="headerlink" title="新增 click handler"></a>新增 click handler</h4><ol>
<li>在 <code>ItemListFragment</code> 中，捲動至 <code>onViewCreated()</code> function，即可更新 adapter 定義。</li>
<li>將 <code>lambda</code> 新增為 <code>ItemListAdapter&#123;&#125;</code> 的 constructor 參數。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> adapter = ItemListAdapter &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>lambda</code> 中，建立名為 <code>action</code> 的 <code>val</code>。您很快便要修正初始化錯誤。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> adapter = ItemListAdapter &#123;</span><br><span class="line">    <span class="keyword">val</span> action</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>對 <code>ItemListFragmentDirections</code> 呼叫 <code>actionItemListFragmentToItemDetailFragment()</code> 方法，傳入 item <code>id</code>。將 return 的 <code>NavDirections</code> object 指派給 <code>action</code>。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> adapter = ItemListAdapter &#123;</span><br><span class="line">   <span class="keyword">val</span> action =  ItemListFragmentDirections.actionItemListFragmentToItemDetailFragment(it.id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在 <code>action</code> 定義下方，使用 <code>this.findNavController()</code> 擷取 <code>NavController</code> instance，然後對其呼叫 <code>navigate()</code>，傳入 <code>action</code>。Adapter 的定義如下所示：</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> adapter = ItemListAdapter &#123;</span><br><span class="line">   <span class="keyword">val</span> action =   ItemListFragmentDirections.actionItemListFragmentToItemDetailFragment(it.id)</span><br><span class="line">   <span class="keyword">this</span>.findNavController().navigate(action)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>執行 app。在 <code>RecyclerView</code> 中按一下某個 item。App 將轉至「Item Details」畫面。請注意，details 為空白(blank)。輕觸 buttons，系統沒有回應。</li>
</ol>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/196553111ee69beb_1920.png?hl=zh-tw" width="40%">

<p>在接下來的步驟中，您要在「Item Details」畫面中顯示 entity details，並為「Sell」和「Delete」button 新增功能。</p>
<h4 id="擷取-item-details"><a href="#擷取-item-details" class="headerlink" title="擷取 item details"></a>擷取 item details</h4><p>在這個步驟中，您將在 <code>InventoryViewModel</code> 中新增 function，以根據 <u>item <code>id</code></u> 從 <strong>database</strong> 中擷取 <u><strong>item details</strong></u>。在下一個步驟中，您將使用此 function 在「Item Details」畫面中顯示 <strong>entity details</strong>。</p>
<ol>
<li>在 <code>InventoryViewModel</code> 中，新增名為 <code>retrieveItem()</code> 的 function，該 function 會以 <code>Int</code> 做為 item <code>id</code>，並 return <code>LiveData&lt;Item&gt;</code>。您很快便要修正 return 運算式錯誤。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">retrieveItem</span><span class="params">(id: <span class="type">Int</span>)</span></span>: LiveData&lt;Item&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在新 function 中，對 <code>itemDao</code> 呼叫 <code>getItem()</code>，並傳入參數 <code>id</code>。<code>getItem()</code> function 會 return <code>Flow</code>。如要將 <code>Flow</code> value 做為 <code>LiveData</code> 使用，請呼叫 <code>asLiveData()</code> function，並將此 function 做為 <code>retrieveItem()</code> function 的 return。已完成的 function 應如下所示：</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">retrieveItem</span><span class="params">(id: <span class="type">Int</span>)</span></span>: LiveData&lt;Item&gt; &#123;</span><br><span class="line">   <span class="keyword">return</span> itemDao.getItem(id).asLiveData()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="將-data-bind-至-TextView"><a href="#將-data-bind-至-TextView" class="headerlink" title="將 data bind 至 TextView"></a>將 data bind 至 TextView</h4><p>在這個步驟中，您將在 <code>ItemDetailFragment</code> 中<u>建立 <code>ViewModel</code> instance</u>，並將 <u><code>ViewModel</code> data</u> bind 至「Item Details」畫面中的 <u><code>TextView</code></u>。您還要將 <strong>observer</strong> 附加至 <u><code>ViewModel</code> 中的 data</u>，以便在 database 中的基礎 data 有所變更時，隨時<u>更新畫面上的 <strong>inventory list</strong></u>。</p>
<ol>
<li>在 <code>ItemDetailFragment</code> 中，新增 type <code>Item</code> entity 的 <code>item</code> 可變動屬性( <code>var</code> )。這個屬性可用來<u>儲存單一 entity 的相關資訊</u>。這個屬性稍後會初始化，請在前面加上 <code>lateinit</code>。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lateinit</span> <span class="keyword">var</span> item: Item</span><br></pre></td></tr></table></figure>
<ul>
<li>import <code>com.example.inventory.data.Item</code></li>
</ul>
<ol start="2">
<li>請於 class <code>ItemDetailFragment</code> 開頭宣告一個 type 為 <code>InventoryViewModel</code> 的 <code>private</code> 不可變屬性 <code>viewModel</code>。使用 <code>by</code> 委派，將屬性初始化作業傳送至 <code>activityViewModels</code> class。傳入 <code>InventoryViewModelFactory</code> constructor。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> viewModel: InventoryViewModel <span class="keyword">by</span> activityViewModels &#123;</span><br><span class="line">   InventoryViewModelFactory(</span><br><span class="line">       (activity?.application <span class="keyword">as</span> InventoryApplication).database.itemDao()</span><br><span class="line">   )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>import <code>androidx.fragment.app.activityViewModels</code>。</li>
</ul>
<ol start="3">
<li>同樣在 <code>ItemDetailFragment</code> 中，建立名為 <code>bind()</code> 的 <code>private</code> function，該 function 會採用 <code>Item</code> entity 的 instance 做為參數，並且不會 return 任何內容。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>實作 <code>bind()</code> function，這與您在 <code>ItemListAdapter</code> 中所進行的操作類似。將 <code>itemName</code> TextView 的 <code>text</code> 屬性設為 <code>item.itemName</code>。對 <code>item</code> 屬性呼叫 <code>getFormattedPrice()</code>，以設定 price value 的格式(format)，然後將其設為 <code>itemPrice</code> TextView 的 <code>text</code> 屬性。將 <code>quantityInStock</code> 轉換為 <code>String</code>，並將其設為 <code>itemQuantity</code> TextView 的 <code>text</code> 屬性。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   binding.itemName.text = item.itemName</span><br><span class="line">   binding.itemPrice.text = item.getFormattedPrice()</span><br><span class="line">   binding.itemCount.text = item.quantityInStock.toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>更新 <code>bind()</code> function，以對程式碼區塊使用 <code>apply&#123;&#125;</code> scope function，如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   binding.apply &#123;</span><br><span class="line">       itemName.text = item.itemName</span><br><span class="line">       itemPrice.text = item.getFormattedPrice()</span><br><span class="line">       itemCount.text = item.quantityInStock.toString()</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>還是在 <code>ItemDetailFragment</code> 中，覆寫 <code>onViewCreated()</code>。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">   <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>在之前某個步驟中，您已從 <code>ItemListFragment</code> 將 item <code>id</code> 做為 navigation 引數傳遞至 <code>ItemDetailFragment</code> 在 <code>onViewCreated()</code> 中的 <b>super</b> function 呼叫下方，建立名為 <code>id</code> 的不可變變數( <code>val</code> )。擷取 navigation 引數並將其指派給這個新的變數。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> id = navigationArgs.itemId</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>接著，請使用這個 <code>id</code> 變數來擷取 <strong>item details</strong>。同樣在 <code>onViewCreated()</code> 中，對傳入 <code>id</code> 的 <code>viewModel</code> 呼叫 <code>retrieveItem()</code> function。將 observer 附加至傳入 <code>viewLifecycleOwner</code> 和 <code>lambda</code> 的 return value。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">viewModel.retrieveItem(id).observe(<span class="keyword">this</span>.viewLifecycleOwner) &#123;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>在 <code>lambda</code> 中，傳入 <code>selectedItem</code> 做為參數，其中包含擷取自 database 的 <code>Item</code> entity。在 <code>lambda</code> function 內文中，將 <code>selectedItem</code> value 指派給 <code>item</code>。呼叫傳入 <code>item</code> 的 <code>bind()</code> function。已完成的 function 應如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">   <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">   <span class="keyword">val</span> id = navigationArgs.itemId</span><br><span class="line">   viewModel.retrieveItem(id).observe(<span class="keyword">this</span>.viewLifecycleOwner) &#123; selectedItem -&gt;</span><br><span class="line">       item = selectedItem</span><br><span class="line">       bind(item)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>執行 app。按一下「Inventory」畫面上的任何 list 元素，系統會隨即顯示「Item Details」畫面。請注意，現在畫面不再為空白(blank)，而是顯示擷取自 inventory database 的 entity details。</li>
</ol>
<div style="display: flex;justify-content: center;">
    <div style="width:40%;float:left;margin-right:10px;">
        <img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/9c416f2fbf1e5ae2_1920.png?hl=zh-tw">
    </div>
    <div style="width:40%;float:left;">
        <img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/ac6529b8cc0801ac_1920.png?hl=zh-tw">
    </div>
<div style="clear:both;"></div>
</div>

<ol start="11">
<li>依序輕觸「Sell」button、「Delete」button 和 FAB button。沒有回應！接下來的工作中，您將實作這些 button 的功能。</li>
</ol>
<hr>
<h3 id="實作-sell-item"><a href="#實作-sell-item" class="headerlink" title="實作 sell item"></a>實作 sell item</h3><p>在這項工作中，您要擴充 app 功能，並<u>實作 <strong>sell</strong> 功能</u>。</p>
<p>以下是這個步驟的詳細操作說明：</p>
<ul>
<li>在 <code>ViewModel</code> 中新增函式以<u>更新 entity</u>。</li>
<li>建立一個新方法，用於<u>減少數量</u>，同時<u>更新 app database 中的 entity</u>。</li>
<li>將 <strong>click listener</strong> 附加到 Sell button。</li>
<li>如果數量為 <code>0</code>，請停用 Sell button。</li>
</ul>
<ol>
<li>在 <code>InventoryViewModel</code> 中，新增名為 <code>updateItem()</code> 的 private 函式，該函式會使用 entity class <code>Item</code> 的 instance 且不會 return 任何內容。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>實作新方法：<code>updateItem()</code>。如要從 <code>ItemDao</code> class 呼叫 <code>update()</code> <strong>suspend</strong> 方法，請使用 <code>viewModelScope</code> 啟動 <strong>coroutine</strong>。在 launch 區塊中，對傳入 <code>item</code> 的 <code>itemDao</code> 呼叫 <code>update()</code> 函式。已完成的方法應如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   viewModelScope.launch &#123;</span><br><span class="line">       itemDao.update(item)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>InventoryViewModel</code> 中，新增其他名為 <code>sellItem()</code> 的方法，該方法會使用 <code>Item</code> entity class 的 instance，且不會 return 任何內容。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sellItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 <code>sellItem()</code> 函式中，新增 <code>if</code> 條件來檢查 <code>item.quantityInStock</code> 是否大於 <code>0</code>。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sellItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (item.quantityInStock &gt; <span class="number">0</span>) &#123;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>if</code> 區塊內，您需要使用 <strong>data class</strong> 的 <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/data-classes.html#copying"><code>copy()</code></a> 函式來<u>更新 entity</u>。</p>
<h5 id="Data-class：copy"><a href="#Data-class：copy" class="headerlink" title="Data class：copy()"></a>Data class：copy()</h5><p>根據預設，系統會向 data class 的所有 <strong>instance</strong> 提供 <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/data-classes.html#copying"><code>copy()</code></a> 函式。此函式可用於<u>複製物件來變更其部分屬性</u>，但保留其餘屬性。</p>
<p>舉例來說，考慮如下所示的 <code>User</code> class 及其 instance <code>jack</code>。如要建立新的 instance 且僅更新 <code>age</code> 屬性，則實作方法如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Data class</span></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">User</span>(<span class="keyword">val</span> name: String = <span class="string">&quot;&quot;</span>, <span class="keyword">val</span> age: <span class="built_in">Int</span> = <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Data class instance</span></span><br><span class="line"><span class="keyword">val</span> jack = User(name = <span class="string">&quot;Jack&quot;</span>, age = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// A new instance is created with its age property changed, rest of the properties unchanged.</span></span><br><span class="line"><span class="keyword">val</span> olderJack = jack.copy(age = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>返回 <code>InventoryViewModel</code> 中的 <code>sellItem()</code> 函式。在 <code>if</code> 區塊中，建立名為 <code>newItem</code> 的新不可變屬性( <code>val</code> )。在傳入更新的 <code>quantityInStock</code> 的 <code>item</code> instance 上呼叫 <code>copy()</code> 函式，藉此減少 <code>1</code> 庫存。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> newItem = item.copy(quantityInStock = item.quantityInStock - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>在 <code>newItem</code> 定義下方，呼叫傳入新的更新 entity (即 <code>newItem</code>) 的 <code>updateItem()</code> 函式。已完成的方法應如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sellItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (item.quantityInStock &gt; <span class="number">0</span>) &#123;</span><br><span class="line">       <span class="comment">// Decrease the quantity by 1</span></span><br><span class="line">       <span class="keyword">val</span> newItem = item.copy(quantityInStock = item.quantityInStock - <span class="number">1</span>)</span><br><span class="line">       updateItem(newItem)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>如要新增<u>銷售庫存(selling stock)</u>功能，請前往 <code>ItemDetailFragment</code>。捲動至 <code>bind()</code> 函式的結尾。在 <code>apply</code> 區塊內，為 Sell button 設定 <strong>click listener</strong>，並在 <code>viewModel</code> 上呼叫 <code>sellItem()</code> 函式。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">binding.apply &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    sellItem.setOnClickListener &#123; viewModel.sellItem(item) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>執行 app。在「Inventory」畫面中，按一下數量大於 <code>0</code> 的 list 元素。系統隨即顯示「Item Details」畫面。輕觸 Sell button。請注意數量值會減少一個單位。</li>
</ol>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/aa63ca761dc8f009_1920.png?hl=zh-tw" width="80%">

<ol start="9">
<li>在「Item Details」畫面上，連續輕觸 Sell button 即可將數量設為 <code>0</code>。數量設為 <code>0</code> 後，輕觸 Sell button。不會出現明顯的變更。這是因為函式 <code>sellItem()</code> 會先檢查數量是否大於 <code>0</code>，然後再更新數量。</li>
</ol>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/3e099d3c55596938_1920.png?hl=zh-tw" width="40%">

<ol start="10">
<li>如要為使用者提供更符合需求的意見回饋，建議您在沒有 item 可銷售時停用 Sell button。在 <code>InventoryViewModel</code> 中，新增函式，檢查數量是否大於 <code>0</code>。將函式命名為 <code>isStockAvailable()</code>，該函式使用 <code>Item</code> instance 並傳回 <code>Boolean</code>。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isStockAvailable</span><span class="params">(item: <span class="type">Item</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> (item.quantityInStock &gt; <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>前往 <code>ItemDetailFragment</code>，捲動至 <code>bind()</code> 函式。在 apply 區塊中，在傳入 <code>item</code> 的 <code>viewModel</code> 上呼叫 <code>isStockAvailable()</code> 函式。請將 return 的 value 設為 Sell button 的 <code>isEnabled</code> 屬性。程式碼應如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   binding.apply &#123;</span><br><span class="line">       ...</span><br><span class="line">       sellItem.isEnabled = viewModel.isStockAvailable(item)</span><br><span class="line">       sellItem.setOnClickListener &#123; viewModel.sellItem(item) &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="12">
<li>執行 app，請注意，當庫存數量為 <code>0</code> 時，系統將停用 Sell button。恭喜您在 app 中實作了 sell item 功能。</li>
</ol>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/5e49db8451e77c2b_1920.png?hl=zh-tw" width="40%">

<h4 id="Delete-item-entity"><a href="#Delete-item-entity" class="headerlink" title="Delete item entity"></a>Delete item entity</h4><p>與上一項工作一樣，您將實作刪除(delete)功能，進一步擴充 app 的功能。</p>
<p>以下是這個步驟的詳細操作說明：</p>
<ul>
<li>在 <code>ViewModel</code> 中新增函式，以<u>從 database 中刪除 entity</u>。</li>
<li>在 <code>ItemDetailFragment</code> 中新增方法，以呼叫新的 delete 函式並處理 navigation。</li>
<li>將 <strong>click listener</strong> 附加到 Delete button。</li>
</ul>
<ol>
<li>在 <code>InventoryViewModel</code> 中，新增名為 <code>deleteItem()</code> 的函式，該函式會使用名為 <code>item</code> 的 <code>Item</code> entity class 的 instance，但不會 return 任何內容。在 <code>deleteItem()</code> 函式中，使用 <code>viewModelScope</code> 啟動 coroutine。在 <code>launch</code> 區塊內，對傳入 <code>item</code> 的 <code>itemDao</code> 呼叫 <code>delete()</code> 方法。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">deleteItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   viewModelScope.launch &#123;</span><br><span class="line">       itemDao.delete(item)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>ItemDetailFragment</code> 中，捲動至 <code>deleteItem()</code> 函式的開頭。對 <code>viewModel</code> 呼叫 <code>deleteItem()</code>，並傳入 <code>item</code>。<code>item</code> instance 會包含目前顯示在「Item Details」畫面上的 entity。已完成的方法應如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">deleteItem</span><span class="params">()</span></span> &#123;</span><br><span class="line">   viewModel.deleteItem(item)</span><br><span class="line">   findNavController().navigateUp()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>ItemDetailFragment</code> 中，捲動至 <code>showConfirmationDialog()</code> 函式。這個函式會在範例程式碼中提供給您。這個方法會顯示 alert dialog，以便在刪除 item 前取得使用者的確認，並在使用者輕觸 <b>positive button</b> 時呼叫 <code>deleteItem()</code> 函式。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">showConfirmationDialog</span><span class="params">()</span></span> &#123;</span><br><span class="line">        MaterialAlertDialogBuilder(requireContext())</span><br><span class="line">            ...</span><br><span class="line">            .setPositiveButton(getString(R.string.yes)) &#123; _, _ -&gt;</span><br><span class="line">                deleteItem()</span><br><span class="line">            &#125;</span><br><span class="line">            .show()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>showConfirmationDialog()</code> 函式會顯示 alert dialog，如下所示：<br><img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/728bfcbb997c8017_1920.png?hl=zh-tw" width="50%"></p>
<ol start="4">
<li>在 <code>ItemDetailFragment</code> 中，請在 <code>bind()</code> 函式結尾的 <code>apply</code> 區塊內，將設定 Delete button 的 click listener。呼叫 click listener <code>lambda</code> 中的 <code>showConfirmationDialog()</code>。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   binding.apply &#123;</span><br><span class="line">       ...</span><br><span class="line">       deleteItem.setOnClickListener &#123; showConfirmationDialog() &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>執行 app！在「Inventory」list 畫面中選取 list 元素，然後在「Item Details」畫面中輕觸「Delete」button。輕觸「Yes」，app 將返回「Inventory」畫面。請注意，已刪除的 entity 已不在 app database 中。恭喜您實作了 delete 功能。</li>
</ol>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/c05318ab8c216fa1_1920.png?hl=zh-tw">

<h4 id="Edit-item-entity"><a href="#Edit-item-entity" class="headerlink" title="Edit item entity"></a>Edit item entity</h4><p>與先前的工作類似，在這項工作中，您要在 app 中新增另一項功能，實作 <u>edit item entity</u>。</p>
<p>以下為編輯 app database 中 entity 的步驟：</p>
<ul>
<li>將 <strong>fragment title</strong> 更新為「Edit Item」，藉此重複使用「Add Item」畫面。</li>
<li>將 <strong>click listener</strong> 新增至 FAB button，前往「Edit Item」畫面。</li>
<li>為 <code>TextView</code> 填入 <u>entity details</u>。</li>
<li>使用 <code>Room</code> 更新 database 中的 entity。</li>
</ul>
<h5 id="將-click-listener-新增至-FAB-button"><a href="#將-click-listener-新增至-FAB-button" class="headerlink" title="將 click listener 新增至 FAB button"></a>將 click listener 新增至 FAB button</h5><p>在 <code>ItemDetailFragment</code> 中，新增名為 <code>editItem()</code> 的 <code>private</code> 函式，該函式不採用任何參數，且不會 return 任何內容。在下一個步驟中，請將畫面標題更新為「Edit Item」，這樣就能重複使用 <code>fragment_add_item.xml</code>。為實作此操作，您需要傳送 <u>fragment title string</u> 以及 <u>item id</u>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">editItem</span><span class="params">()</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更新 fragment title 後，「Edit Item」畫面應顯示如下。<br><img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/bcd407af7c515a21_1920.png?hl=zh-tw" width="40%"></p>
<ol start="2">
<li>在 <code>editItem()</code> 函式中，建立名為 <code>action</code> 的不可變變數( <code>val</code> )。對傳入 title string  <code>edit_fragment_title</code> 和 item <code>id</code> 的 <code>ItemDetailFragmentDirections</code> 呼叫 <code>actionItemDetailFragmentToAddItemFragment()</code>。將 return 的 value 指派給 <code>action</code>。在 <code>action</code> 定義下方，呼叫 <code>this.findNavController().navigate()</code> 並傳入 <code>action</code>，前往「Edit Item」畫面。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">editItem</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">val</span> action = ItemDetailFragmentDirections.actionItemDetailFragmentToAddItemFragment(</span><br><span class="line">       getString(R.string.edit_fragment_title),</span><br><span class="line">       item.id</span><br><span class="line">   )</span><br><span class="line">   <span class="keyword">this</span>.findNavController().navigate(action)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>還是在 <code>ItemDetailFragment</code> 中，捲動至 <code>bind()</code> 函式。在 <code>apply</code> 區塊內，為 FAB button 設定 <strong>click listener</strong>，以及從 <code>lambda</code> 呼叫 <code>editItem()</code> 函式，以便前往「Edit Item」畫面。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   binding.apply &#123;</span><br><span class="line">       ...</span><br><span class="line">       editItem.setOnClickListener &#123; editItem() &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>執行 app。前往「Item Details」畫面。按一下 FAB button。請注意，螢幕 title 已更新為「Edit Item」，但所有 <strong>text fields</strong> 均為<u>空白(empty)</u>。在下一個步驟中，您將修正這個問題。</li>
</ol>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/a6a6583171b68230_1920.png?hl=zh-tw" width="80%">

<h5 id="填入-TextView"><a href="#填入-TextView" class="headerlink" title="填入 TextView"></a>填入 TextView</h5><p>在這個步驟中，您要在「Edit Item」螢幕的 <strong>text fields</strong> 中填入 <strong>entity details</strong>。由於我們使用的是 <code>Add Item</code> 螢幕，因此您要在 Kotlin 檔案 <code>AddItemFragment.kt</code> 中新增函式。</p>
<ol>
<li>在 <code>AddItemFragment</code> 中，新增 <code>private</code> 函式，<u>將 <strong>text fields</strong> 與 <strong>entity details</strong> bind 在一起</u>。為函式 <code>bind()</code> 命名，該函式會使用商品 entity class 的 instance，且不會 return 任何內容。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>bind()</code> 函式的實作方式與先前在 <code>ItemDetailFragment</code> 中的實作類似。在 <code>bind()</code> 函式中，使用 <code>format()</code> 函式將 price 四捨五入至小數點後兩位，並指派給名為 <code>price</code> 的 <code>val</code>，如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> price = <span class="string">&quot;%.2f&quot;</span>.format(item.itemPrice)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>price</code> 定義下方，針對 <code>binding</code> 屬性使用 <code>apply</code> scope function，如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">binding.apply &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 <code>apply</code> scope function 程式碼區塊內，將 <code>item.itemName</code> 設為 <code>itemName</code> 的 <code>text</code> 屬性。使用 <code>setText()</code> 函式，並傳入 <code>item.itemName</code> string 和 <code>TextView.BufferType.SPANNABLE</code> 做為 <code>BufferType</code>。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">binding.apply &#123;</span><br><span class="line">   itemName.setText(item.itemName, TextView.BufferType.SPANNABLE)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>類似於上述步驟，設定 price <code>EditText</code> 的 <code>text</code> 屬性，如下所示。如要設定 <code>EditEdit</code> 數量的 <code>text</code> 屬性，請記得將 <code>item.quantityInStock</code> 轉換為 <code>String</code>。您完成的函式應如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   <span class="keyword">val</span> price = <span class="string">&quot;%.2f&quot;</span>.format(item.itemPrice)</span><br><span class="line">   binding.apply &#123;</span><br><span class="line">       itemName.setText(item.itemName, TextView.BufferType.SPANNABLE)</span><br><span class="line">       itemPrice.setText(price, TextView.BufferType.SPANNABLE)</span><br><span class="line">       itemCount.setText(item.quantityInStock.toString(), TextView.BufferType.SPANNABLE)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>在 <code>AddItemFragment</code> 中，捲動至 <code>onViewCreated()</code> 函式。在呼叫 super class 函式之後。建立名為 <code>id</code> 的 <code>val</code>，並從 navigation 引數擷取 <code>itemId</code>。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> id = navigationArgs.itemId</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>新增帶有條件的 <code>if-else</code> 區塊，以檢查 <code>id</code> 是否大於零，並將 Save button 的 <strong>click listener</strong> 移至 <code>else</code> 區塊。在 <code>if</code> 區塊內，使用 <code>id</code> 擷取 entity，然後在其中新增 observer。在 observer 內部，更新 <code>item</code> 屬性並呼叫傳入 <code>item</code> 的 <code>bind()</code>。系統會提供完整函式供您複製貼上。這個函式簡單易懂，您可以自行研究。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">   <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">   <span class="keyword">val</span> id = navigationArgs.itemId</span><br><span class="line">   <span class="keyword">if</span> (id &gt; <span class="number">0</span>) &#123;</span><br><span class="line">       viewModel.retrieveItem(id).observe(<span class="keyword">this</span>.viewLifecycleOwner) &#123; selectedItem -&gt;</span><br><span class="line">           item = selectedItem</span><br><span class="line">           bind(item)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       binding.saveAction.setOnClickListener &#123;</span><br><span class="line">           addNewItem()</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>執行 app，前往「Item Details」，然後輕觸「+」這個 FAB button。請注意，這些欄位會填入 item details。編輯 stock quantity 或任何其他欄位，然後輕觸 Save button。沒有回應！這是因為您<u>並未更新 app database 中的 entity</u>。您很快就會解決這個問題。</li>
</ol>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/829ceb9dd7993215_1920.png?hl=zh-tw" width="80%">

<h5 id="使用-Room-更新-entity"><a href="#使用-Room-更新-entity" class="headerlink" title="使用 Room 更新 entity"></a>使用 Room 更新 entity</h5><p>在最後一項工作中，新增最後一段程式碼來實作更新功能。您要在 <code>ViewModel</code> 中定義必要的函式，並在 <code>AddItemFragment</code> 中使用它們。</p>
<ol>
<li>在 <code>InventoryViewModel</code> 中，新增名為 <code>getUpdatedItemEntry()</code> 的 <code>private</code> 函式，該函式使用 <code>Int</code>，以及 entity details 三個名為 <code>itemName</code>、<code>itemPrice</code> 和 <code>itemCount</code> 的 string。Return 函式的 <code>Item</code> instance。程式碼僅供參考。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getUpdatedItemEntry</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">   itemId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemName: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemPrice: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemCount: <span class="type">String</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Item &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>getUpdatedItemEntry()</code> 函式中，使用函式參數建立 item instance，如下所示。Return 函式的 <code>Item</code> instance。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getUpdatedItemEntry</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">   itemId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemName: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemPrice: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemCount: <span class="type">String</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Item &#123;</span><br><span class="line">   <span class="keyword">return</span> Item(</span><br><span class="line">       id = itemId,</span><br><span class="line">       itemName = itemName,</span><br><span class="line">       itemPrice = itemPrice.toDouble(),</span><br><span class="line">       quantityInStock = itemCount.toInt()</span><br><span class="line">   )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>同樣在 <code>InventoryViewModel</code> 中，新增其他名為 <code>updateItem()</code> 的函式。此函式也會使用 <code>Int</code> 和 entity details 的三個 strung，且不會 return 任何內容。使用以下程式碼片段中的變數名稱。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">updateItem</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">   itemId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemName: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemPrice: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemCount: <span class="type">String</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 <code>updateItem()</code> 函式中，呼叫傳入 entity 資訊的 <code>getUpdatedItemEntry()</code> 函式，該函式會以函式參數的形式傳遞，如下所示。將 return 的 value 指派給名為 <code>updatedItem</code> 的不可變變數( <code>val</code> )。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> updatedItem = getUpdatedItemEntry(itemId, itemName, itemPrice, itemCount)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在 <code>getUpdatedItemEntry()</code> 函式呼叫的正下方，呼叫傳入 <code>val</code> <code>updatedItem</code> 的 <code>updateItem(item: Item)</code> 函式。已完成的函式如下所示：</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">updateItem</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">   itemId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemName: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemPrice: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">   itemCount: <span class="type">String</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">   <span class="comment">// 呼叫 getUpdatedItemEntry()，取得 Item object</span></span><br><span class="line">   <span class="keyword">val</span> updatedItem = getUpdatedItemEntry(itemId, itemName, itemPrice, itemCount)</span><br><span class="line">   <span class="comment">// 將 Item object 傳入 updateItem(item: Item) 以更新 database</span></span><br><span class="line">   updateItem(updatedItem)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>返回 <code>AddItemFragment</code>，新增名為 <code>updateItem()</code> 的 private 函式，該函式不含任何參數，且不會 return 任何內容。在函式中，新增 <code>if</code> 條件，以透過呼叫函式 <code>isEntryValid()</code> 來驗證使用者輸入內容。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateItem</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (isEntryValid()) &#123;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>在 <code>if</code> 區塊中，呼叫傳遞 entity details 的 <code>viewModel.updateItem()</code>。請使用 navigation 引數中的 <code>itemId</code>，以及 <code>EditText</code> 中的其他 entity details，例如 name、price 和 quantity，如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">viewModel.updateItem(</span><br><span class="line">    <span class="keyword">this</span>.navigationArgs.itemId,</span><br><span class="line">    <span class="keyword">this</span>.binding.itemName.text.toString(),</span><br><span class="line">    <span class="keyword">this</span>.binding.itemPrice.text.toString(),</span><br><span class="line">    <span class="keyword">this</span>.binding.itemCount.text.toString()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>在 <code>updateItem()</code> 函式呼叫下方，定義名為 <code>action</code> 的 <code>val</code>。對 <code>AddItemFragmentDirections</code> 呼叫 <code>actionAddItemFragmentToItemListFragment()</code>，並將 return 的 value 指派給 <code>action</code>。請瀏覽(navigate)至 <code>ItemListFragment</code>，並呼叫傳入 <code>action</code> 的 <code>findNavController().navigate()</code>。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateItem</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (isEntryValid()) &#123;</span><br><span class="line">       viewModel.updateItem(</span><br><span class="line">           <span class="keyword">this</span>.navigationArgs.itemId,</span><br><span class="line">           <span class="keyword">this</span>.binding.itemName.text.toString(),</span><br><span class="line">           <span class="keyword">this</span>.binding.itemPrice.text.toString(),</span><br><span class="line">           <span class="keyword">this</span>.binding.itemCount.text.toString()</span><br><span class="line">       )</span><br><span class="line">       <span class="keyword">val</span> action = AddItemFragmentDirections.actionAddItemFragmentToItemListFragment()</span><br><span class="line">       findNavController().navigate(action)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>還是在 <code>AddItemFragment</code> 中，捲動至 <code>bind()</code> 函式。在 <code>binding.apply</code> scope functino 區塊中，為 Save button 設定 <strong>click listener</strong>。呼叫 <code>lambda</code> 中的 <code>updateItem()</code> 函式，如下所示。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">   ...</span><br><span class="line">   binding.apply &#123;</span><br><span class="line">       ...</span><br><span class="line">       saveAction.setOnClickListener &#123; updateItem() &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<ol start="10">
<li>執行 app！嘗試編輯 inventory items；您應該可以編輯 inventory app database 中的任何 item。</li>
</ol>
<img src="https://developer.android.com/static/codelabs/basic-android-kotlin-training-update-data-room/img/1bbd094a77c25fc4_1920.png?hl=zh-tw">

<h4 id="App-執行結果"><a href="#App-執行結果" class="headerlink" title="App 執行結果"></a>App 執行結果</h4><p>完成的 app 如下：</p>
<div style="position:relative; overflow:hidden; width:100%; padding-top:75%;">
    <iframe src="https://streamable.com/e/40ijw0" frameborder="0" width="100%" height="100%" allowfullscreen style="position:absolute; top:0; left:0; bottom:0; right:0; width:100%; height:100%;">
    </iframe>
</div>
<div style="clear:static;"></div>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/Kotlin/" rel="tag"># Kotlin</a>
              <a href="/tags/RecyclerView/" rel="tag"># RecyclerView</a>
              <a href="/tags/Data-Class/" rel="tag"># Data Class</a>
              <a href="/tags/Navigation/" rel="tag"># Navigation</a>
              <a href="/tags/Fragment/" rel="tag"># Fragment</a>
              <a href="/tags/ViewModel/" rel="tag"># ViewModel</a>
              <a href="/tags/LiveData/" rel="tag"># LiveData</a>
              <a href="/tags/Coroutine/" rel="tag"># Coroutine</a>
              <a href="/tags/suspend-function/" rel="tag"># suspend function</a>
              <a href="/tags/SQL/" rel="tag"># SQL</a>
              <a href="/tags/ListAdapter/" rel="tag"># ListAdapter</a>
              <a href="/tags/Room/" rel="tag"># Room</a>
              <a href="/tags/DAO/" rel="tag"># DAO</a>
              <a href="/tags/Entity/" rel="tag"># Entity</a>
              <a href="/tags/Flow/" rel="tag"># Flow</a>
              <a href="/tags/SQLite/" rel="tag"># SQLite</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/12/20/Android%E7%AD%86%E8%A8%98-40-%E4%BD%BF%E7%94%A8Room%E5%84%B2%E5%AD%98persist-data/" rel="prev" title="Android筆記(40)-使用Room儲存persist data">
      <i class="fa fa-chevron-left"></i> Android筆記(40)-使用Room儲存persist data
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/12/24/Android%E7%AD%86%E8%A8%98-42-Repository-Pattern/" rel="next" title="Android筆記(42)-Repository Pattern">
      Android筆記(42)-Repository Pattern <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Starter-app-overview"><span class="nav-number">1.</span> <span class="nav-text">Starter app overview</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BC%89%E7%AF%84%E4%BE%8B%E7%A8%8B%E5%BC%8F%E7%A2%BC"><span class="nav-number">1.1.</span> <span class="nav-text">下載範例程式碼</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E-RecyclerView"><span class="nav-number">2.</span> <span class="nav-text">新增 RecyclerView</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E-helper-function-%E4%BB%A5-format-price"><span class="nav-number">2.1.</span> <span class="nav-text">新增 helper function 以 format price</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Extension-Functions"><span class="nav-number">2.1.1.</span> <span class="nav-text">Extension Functions</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E-ListAdapter"><span class="nav-number">2.2.</span> <span class="nav-text">新增 ListAdapter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-ListAdapter"><span class="nav-number">2.3.</span> <span class="nav-text">使用 ListAdapter</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%AF%E7%A4%BA-item-details"><span class="nav-number">3.</span> <span class="nav-text">顯示 item details</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E-click-handler"><span class="nav-number">3.1.</span> <span class="nav-text">新增 click handler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%93%B7%E5%8F%96-item-details"><span class="nav-number">3.2.</span> <span class="nav-text">擷取 item details</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%87-data-bind-%E8%87%B3-TextView"><span class="nav-number">3.3.</span> <span class="nav-text">將 data bind 至 TextView</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%A6%E4%BD%9C-sell-item"><span class="nav-number">4.</span> <span class="nav-text">實作 sell item</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Data-class%EF%BC%9Acopy"><span class="nav-number">4.0.1.</span> <span class="nav-text">Data class：copy()</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Delete-item-entity"><span class="nav-number">4.1.</span> <span class="nav-text">Delete item entity</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Edit-item-entity"><span class="nav-number">4.2.</span> <span class="nav-text">Edit item entity</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B0%87-click-listener-%E6%96%B0%E5%A2%9E%E8%87%B3-FAB-button"><span class="nav-number">4.2.1.</span> <span class="nav-text">將 click listener 新增至 FAB button</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A1%AB%E5%85%A5-TextView"><span class="nav-number">4.2.2.</span> <span class="nav-text">填入 TextView</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Room-%E6%9B%B4%E6%96%B0-entity"><span class="nav-number">4.2.3.</span> <span class="nav-text">使用 Room 更新 entity</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#App-%E5%9F%B7%E8%A1%8C%E7%B5%90%E6%9E%9C"><span class="nav-number">4.3.</span> <span class="nav-text">App 執行結果</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tina Tang"
      src="/images/blog_photo.png">
  <p class="site-author-name" itemprop="name">Tina Tang</p>
  <div class="site-description" itemprop="description">^(-o-)></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">122</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/linglingdr00" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;linglingdr00" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tinatang0424@gmail.com" title="E-Mail → mailto:tinatang0424@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tina Tang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
